package com.ejb;

import com.messaging.RabbitMQConnector;
import com.rabbitmq.client.Channel;  // Correct import
import jakarta.annotation.PostConstruct;
import jakarta.ejb.Stateless;

@Stateless
public class LogProducerBean {

    private Channel channel;
    private static final String EXCHANGE = "log.exchange";

    @PostConstruct
    private void init() throws Exception {
        channel = RabbitMQConnector.createChannel();
        channel.exchangeDeclare(EXCHANGE, "topic", true);
    }

    public void log(String serviceName, String severity, String message) {
        try {
            String rk = serviceName + "." + severity;
            channel.basicPublish(EXCHANGE, rk, null, message.getBytes("UTF-8"));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
