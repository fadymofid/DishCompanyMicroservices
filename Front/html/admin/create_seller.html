<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Seller Account</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <div id="navbar"></div>
  <script>
    fetch('/html/fragment/_navbar.html')
      .then(res => res.text())
      .then(html => { document.getElementById('navbar').innerHTML = html; });
  </script>
<div class="container mt-5">
  <h2>Create Seller Accounts</h2>
  <form id="createSellerForm" class="row g-3">
    <div class="col-md-6">
      <label for="startName" class="form-label">Start Name</label>
      <input type="text" class="form-control" id="startName" required>
    </div>
    <div class="col-md-6">
      <label for="endName" class="form-label">End Name</label>
      <input type="text" class="form-control" id="endName" required>
    </div>
    <div class="col-md-6">
      <label for="username" class="form-label">Username (rep login)</label>
      <input type="text" class="form-control" id="username" required>
    </div>
    <!-- Password is always auto-generated, so no password template field -->
    <div class="col-12">
      <button type="submit" class="btn btn-primary">Create Sellers</button>
    </div>
  </form>

  <div id="errorMessage" class="alert alert-danger mt-3" style="display:none;"></div>
  <div id="successMessage" class="alert alert-success mt-3" style="display:none;"></div>

  <h3 class="mt-5">Recently Created</h3>
  <table class="table table-striped" id="createdTable">
    <thead>
    <tr>
      <th>Company</th>
      <th>Username</th>
      <th>Password</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="window.location.href='admin_home.html'" class="btn btn-secondary mt-3">Back to Admin Home</button>
</div>

<script>
  const form = document.getElementById('createSellerForm');
  const errEl = document.getElementById('errorMessage');
  const successEl = document.getElementById('successMessage');
  const tableBody = document.querySelector('#createdTable tbody');

  form.addEventListener('submit', async e => {
    e.preventDefault();
    errEl.style.display = 'none';
    successEl.style.display = 'none';

    const startName = document.getElementById('startName').value.trim();
    const endName = document.getElementById('endName').value.trim();
    const username = document.getElementById('username').value.trim();

    try {
      const resp = await fetch('http://localhost:8081/admin/sellers', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ startName, endName, username })
      });
      if (!resp.ok) {
        const payload = await resp.json().catch(()=>({}));
        throw new Error(payload.error || 'Create seller failed');
      }
      const dtos = await resp.json();
      if (Array.isArray(dtos)) {
        successEl.textContent = `Created ${dtos.length} sellers.`;
        dtos.forEach(dto => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${dto.companyName}</td>
            <td>${dto.username}</td>
            <td>${dto.password}</td>
          `;
          tableBody.prepend(row);
        });
      } else {
        successEl.textContent = `Seller "${dtos.companyName}" created with username "${dtos.username}".`;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${dtos.companyName}</td>
          <td>${dtos.username}</td>
          <td>${dtos.password}</td>
        `;
        tableBody.prepend(row);
      }
      successEl.style.display = 'block';
      form.reset();
    } catch(err) {
      errEl.textContent = err.message;
      errEl.style.display = 'block';
    }
  });
</script>
<script src="../../js/app.js"></script>
</body>
</html>
