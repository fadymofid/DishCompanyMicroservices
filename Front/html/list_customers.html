<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer List</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="mb-4">Registered Customers</h2>

  <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>

  <table id="customersTable" class="table table-bordered table-hover bg-white">
    <thead class="thead-dark">
    <tr>
      <th>ID</th>
      <th>Username</th>
      <th>Address</th>
    </tr>
    </thead>
    <tbody>
    <!-- Customer rows will be dynamically injected here -->
    </tbody>
  </table>
</div>

<script>
  const tableBody = document.querySelector('#customersTable tbody');
  const errEl = document.getElementById('errorMessage');

  async function fetchCustomers() {
    errEl.style.display = 'none';

    try {
      const resp = await fetch('http://localhost:8081/admin/customers');
      if (!resp.ok) {
        const payload = await resp.json().catch(() => ({}));
        throw new Error(payload.error || 'Failed to load customers');
      }

      const customers = await resp.json();
      tableBody.innerHTML = ''; // Clear previous rows

      if (customers.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="3" class="text-center text-muted">No customers found.</td>`;
        tableBody.appendChild(row);
      } else {
        customers.forEach(c => {
          const row = document.createElement('tr');
          row.innerHTML = `
              <td>${c.id}</td>
              <td>${c.username}</td>
              <td>${c.address}</td>
            `;
          tableBody.appendChild(row);
        });
      }
    } catch (err) {
      errEl.textContent = err.message;
      errEl.style.display = 'block';
    }
  }

  // Fetch customers when the page loads
  window.addEventListener('DOMContentLoaded', fetchCustomers);
</script>

</body>
</html>
