<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Seller Account</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
<div class="container mt-5">
  <h2>Create Seller Account</h2>
  <form id="createSellerForm" class="row g-3">
    <div class="col-md-6">
      <label for="companyName" class="form-label">Company Name</label>
      <input type="text" class="form-control" id="companyName" required>
    </div>
    <div class="col-md-6">
      <label for="username" class="form-label">Username (rep login)</label>
      <input type="text" class="form-control" id="username" required>
    </div>
    <div class="col-12">
      <button type="submit" class="btn btn-primary">Create Seller</button>
    </div>
  </form>

  <div id="errorMessage" class="alert alert-danger mt-3" style="display:none;"></div>
  <div id="successMessage" class="alert alert-success mt-3" style="display:none;"></div>

  <h3 class="mt-5">Recently Created</h3>
  <table class="table table-striped" id="createdTable">
    <thead>
    <tr>
      <th>Company</th>
      <th>Username</th>
      <th>Password</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const form = document.getElementById('createSellerForm');
  const errEl = document.getElementById('errorMessage');
  const successEl = document.getElementById('successMessage');
  const tableBody = document.querySelector('#createdTable tbody');

  form.addEventListener('submit', async e => {
    e.preventDefault();
    errEl.style.display = 'none';
    successEl.style.display = 'none';

    const companyName = document.getElementById('companyName').value.trim();
    const username    = document.getElementById('username').value.trim();

    try {
      const resp = await fetch('http://localhost:8081/admin/sellers', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ companyName, username })
      });
      if (!resp.ok) {
        const payload = await resp.json().catch(()=>({}));
        throw new Error(payload.error || 'Create seller failed');
      }
      const dto = await resp.json();
      successEl.textContent = `Seller "${dto.companyName}" created with username "${dto.username}".`;
      successEl.style.display = 'block';

      // append to table
      const row = document.createElement('tr');
      row.innerHTML = `
          <td>${dto.companyName}</td>
          <td>${dto.username}</td>
          <td>${dto.password}</td>
        `;
      tableBody.prepend(row);

      form.reset();
    } catch(err) {
      errEl.textContent = err.message;
      errEl.style.display = 'block';
    }
  });
</script>
</body>
</html>
